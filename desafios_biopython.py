# -*- coding: utf-8 -*-
"""Desafios_biopython.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1NZ5jhkbcXscd7yQ6PScX0CzkUU21ON4z

# **Desafios Pr√°ticos com Biopython: BLAST Online, Entrez e SeqIO Integrados**
---

Ol√°! Chegou a hora de colocar a m√£o na massa e aplicar tudo o que aprendemos sobre Biopython! Estes desafios foram cuidadosamente elaborados para que voc√™s possam integrar o uso dos m√≥dulos Bio.Entrez (para busca e download de dados), Bio.SeqIO (para manipula√ß√£o de arquivos de sequ√™ncia) e Bio.Blast.NCBIWWW (para realizar buscas por similaridade online).

Lembrem-se que √© crucial configurar o seu e-mail no Entrez e no Blast.

## **Desafio 1: Anotando um Gene de Levedura Desconhecido**

Voc√™ est√° trabalhando com dados de sequenciamento de *Saccharomyces cerevisiae* (levedura de padaria) e acabou de obter um fragmento de DNA que parece ser parte de um gene. Sua miss√£o √© usar as ferramentas do Biopython para tentar identificar esse gene e inferir sua poss√≠vel fun√ß√£o.
"""

# Installing BioPython
!pip install biopython

"""**Sua Tarefa:**

1. Blast Online: Realize uma busca `blastn` no NCBI (`Bio.Blast.NCBIWWW`) utilizando a sequ√™ncia acima como sua consulta. Aponte a busca para o banco de dados `nr` (Nucleotide Collection). Defina um E-value m√°ximo de `1e-10` e limite a lista de hits retornados para os 5 melhores (`hitlist_size=5`). Salve a sa√≠da XML do BLAST em um arquivo chamado `blast_results_levedura.xml`.   
2. An√°lise do Melhor Hit: Usando `Bio.Blast.NCBIXML`, leia o arquivo `blast_results_levedura.xml`. Encontre o melhor hit (aquele com o menor E-value). Imprima no console o ID de acesso (`Accession Number`) e o t√≠tulo completo desse melhor hit.   
3. Download da Sequ√™ncia Completa: Com o `Accession Number` do melhor hit em m√£os, utilize `Bio.Entrez.efetch` para baixar a sequ√™ncia completa desse gene do banco de dados nucleotide do NCBI, no formato FASTA.
4. Salvamento e Verifica√ß√£o: `Use Bio.SeqIO.read` para carregar a sequ√™ncia que voc√™ acabou de baixar e, em seguida, salve-a em um novo arquivo FASTA chamado `melhor_hit_levedura.fasta`. Imprima no console o ID, a descri√ß√£o e o comprimento dessa sequ√™ncia completa baixada para confirmar que tudo correu bem.
"""

# C√≥digo para executar BLAST online (QBlast) usando Entrez para submiss√£o e recupera√ß√£o

from Bio.Blast import NCBIWWW
from Bio.Blast import NCBIXML
from Bio import Entrez
from Bio import SeqIO
from Bio.Seq import Seq # Importar Seq diretamente
import os

# --- Accese ao seu Google Drive ---

# --- Mude o path at√© a pasta onde est√° o arquivo ---

# --- Configura√ß√µes Iniciais ---

# --- Passo 1: Sequ√™ncia de Consulta ---

# --- Passo 2: BLAST Online (NCBIWWW) ---

# --- Passo 3: An√°lise dos Resultados (NCBIXML) ---

# --- Passo 4: Download da Sequ√™ncia Completa (Entrez e SeqIO) ---

# --- Salva a sequ√™ncia completa em um novo arquivo FASTA ---

"""## **Desafio 2: Investigando a Conserva√ß√£o da Insulina em Mam√≠feros**

Voc√™ tem curiosidade sobre qu√£o conservada a prote√≠na insulina √© entre diferentes esp√©cies de mam√≠feros. Este desafio o guiar√° na obten√ß√£o dessas sequ√™ncias e na sua compara√ß√£o usando o BLAST online.

**Sua Tarefa:**

1. Busca e Download de Sequ√™ncias:  
Utilize Bio.Entrez.esearch para buscar sequ√™ncias da prote√≠na insulina (insulin [PROTEIN]) especificamente das esp√©cies Homo sapiens, Mus musculus, Rattus norvegicus e Bos taurus no banco de dados protein do NCBI.   
Com os IDs retornados, use Bio.Entrez.efetch para baixar as sequ√™ncias dessas prote√≠nas no formato FASTA.
Salve todas as sequ√™ncias baixadas em um √∫nico arquivo FASTA multi-entrada chamado insulinas_mamiferos.fasta.
2. Consulta da Insulina Humana:
A partir do arquivo insulinas_mamiferos.fasta, identifique e selecione a sequ√™ncia da insulina humana como sua sequ√™ncia de consulta.   
3. Blast Online:
Submeta a sequ√™ncia da insulina humana para uma busca blastp contra o banco de dados nr (Non-redundant protein sequences) do NCBI.
Defina um E-value m√°ximo de 1e-5 e um limite de hitlist_size=10. Salve a sa√≠da XML em blast_insulina_humana_vs_nr.xml.
4. An√°lise Detalhada dos Hits:
Usando Bio.Blast.NCBIXML, parseie o arquivo blast_insulina_humana_vs_nr.xml.
Para cada hit (alinhamento), imprima no console:
* O t√≠tulo completo do hit.
* O Accession Number.
* O E-value do melhor HSP (High-scoring Segment Pair).    
* A porcentagem de identidade do melhor HSP.  

**Desafio Extra:** Tente extrair e imprimir o nome do organismo e, se poss√≠vel, o nome do gene/prote√≠na a partir do t√≠tulo do hit (Dica: pense em como usar fun√ß√µes de string como split() ou express√µes regulares).
"""

from Bio import Entrez
from Bio import SeqIO
from Bio.Blast import NCBIWWW
from Bio.Blast import NCBIXML
from Bio.Seq import Seq
import os
import re # Para extra√ß√£o de informa√ß√µes do t√≠tulo
import time # Para pausas entre requisi√ß√µes

# --- Configura√ß√µes Iniciais ---

# --- Passo 1: Busca e Download de Sequ√™ncias (Entrez e SeqIO) ---

# --- Passo 2: Preparar Sequ√™ncia de Consulta (Insulina Humana) ---

# --- Passo 3: BLAST Online (NCBIWWW) da Insulina Humana contra 'nr' ---

# --- Passo 4: An√°lise e Filtragem dos Resultados (NCBIXML) ---

"""## **Desafio 3: Identifica√ß√£o de uma Nova Sequ√™ncia de mRNA em um Projeto de Pesquisa**
---

Imagine que voc√™ recebeu um arquivo contendo v√°rias sequ√™ncias de mRNA curtas de um projeto de sequenciamento. Seu objetivo √© identificar rapidamente a qual organismo e gene cada uma dessas sequ√™ncias pertence usando o BLAST online e gerar um relat√≥rio conciso.  

Sequ√™ncias de mRNA de Consulta:  

Crie um arquivo FASTA chamado mRNAs_desconhecidos.fasta com as seguintes sequ√™ncias:   

```
>mRNA_1
AGGTCATGTACGATGCATGCATGCATGCATGCATGCATGCATGCATGCATGCATGCATG
>mRNA_2
TGCGCGTGCGCGTGCGCGTGCGCGTGCGCGTGCGCGTGCGCGTGCGCGTGCGCGTGCGC
>mRNA_3
GCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGC
```

**Sua Tarefa:**

1. Processamento de M√∫ltiplas Consultas:
Leia o arquivo mRNAs_desconhecidos.fasta usando Bio.SeqIO.parse para obter cada SeqRecord individualmente.
Para cada SeqRecord (cada mRNA):
* Submeta-o a uma busca blastn contra o banco de dados nr do NCBI.
* Defina um E-value m√°ximo de 1e-5 e limite o n√∫mero de hits a 3.
* ATEN√á√ÉO: Para n√£o sobrecarregar os servidores do NCBI, inclua uma pausa de time.sleep(5) (5 segundos) entre cada submiss√£o de BLAST.
* Salve a sa√≠da XML de cada busca em um arquivo separado, por exemplo, blast_mRNA_1.xml, blast_mRNA_2.xml, etc., dentro de um diret√≥rio que voc√™ pode criar para organizar os resultados (e.g., blast_mRNA_results/).
2. Gera√ß√£o de Relat√≥rio Personalizado:
Ap√≥s todas as buscas serem conclu√≠das e salvas, itere sobre os arquivos XML gerados.
Para cada arquivo XML, parseie-o e extraia as seguintes informa√ß√µes do melhor hit (o primeiro alinhamento encontrado):
* O ID da sequ√™ncia de consulta (o mRNA_X).
* O Accession Number do hit.
* O t√≠tulo completo do hit.
* O E-value do melhor HSP.
* A porcentagem de identidade do melhor HSP.
3. Imprima essas informa√ß√µes no console de forma organizada e leg√≠vel, como um pequeno relat√≥rio para cada mRNA.
"""

from Bio.Blast import NCBIWWW
from Bio.Blast import NCBIXML
from Bio import SeqIO
from Bio.Seq import Seq # Importar Seq diretamente
import os
import time # Para pausas entre requisi√ß√µes
import re # Para extra√ß√£o de informa√ß√µes

# --- Configura√ß√µes Iniciais ---

# --- Passo 1: Cria√ß√£o do Arquivo de M√∫ltiplas Consultas (SeqIO) ---

# --- Passo 2: BLAST Online de M√∫ltiplas Consultas (NCBIWWW) ---

# --- Passo 3: Processamento e Relat√≥rio Personalizado ---

"""Este caderno foi criado com ‚ô• pela [Natalia Coutoun√©]().   
D√∫vidas? Pode-me escrever ao meu [email](nat.coutoune@gmail.com) üìß.
"""